<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>T다이렉트샵 API 점검</title>
	<link rel="stylesheet" href="./static/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="./static/assets/css/font-awesome.min.css">
	<link rel="stylesheet" href="./static/assets/css/owl.carousel.min.css">
	<link rel="stylesheet" href="./static/assets/css/modal-video.min.css">
	<link rel="stylesheet" href="./static/assets/css/animate.css">
	<link rel="stylesheet" href="./static/assets/css/normalize.css">
	<link rel="stylesheet" href="./static/assets/css/style.css">
	<link rel="stylesheet" href="./static/assets/css/responsive.css">

	<script src="./static/assets/js/jquery.3.2.1.min.js"></script>

</head>

<body>

	<!-- Start Header area
======================================-->
	<div class="feature-page header-area">
		<div class="container">
			<div class="header-top">
				<nav class="navbar navbar-expand-lg navbar-light fixed-top">
					<!-- <a class="navbar-brand" href="#" onclick="index()"><img src="./static/assets/img/logo.png" alt="" class="logo"></a> -->
                    <!-- <a class="navbar-brand" href="index.html"><img src="./static/assets/img/logo.png" alt="" class="logo"></a> -->
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

					<div class="collapse navbar-collapse my-2 my-lg-0" id="navbarSupportedContent">
						<div class="mainmenu">
							<ul class="navbar-nav ml-auto">
								<li class="nav-item">
									<a class="nav-link" href="#" onclick="index()">Home <span class="sr-only">(current)</span></a>
								</li>
								<li class="nav-item dropdown">
									<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API 점검</a>
									<div class="dropdown-menu" aria-labelledby="navbarDropdown">
										<a class="dropdown-item" href="#" onclick="insert_api_info()">API 등록</a>
										<a class="dropdown-item" href="#" onclick="redirectToRequestPage()">API 조회</a>
									</div>
								</li>
								<li class="getstart"><a class="active" href="#" onclick="alert('준비중입니다.')">get started</a></li>
							</ul>
						</div>
					</div>
				</nav>
				<!--End of nav bar-->
			</div>
			<!--End of header top-->
			<div class="row justify-content-center">
				<div class="col-lg-6 text-center">
					<div class="hero-text-wrapper">
						<div class="hero-text-inner">
							<div class="hero-text">
								<h6>T다이렉트샵</h6>
								<h1>API 조회</h1>
								<p>In/Out-bound API Health Monitoring </p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--End of row-->
		</div>
		<!--End of Container-->
		<a href="#section1" class="scrl-down scroll-down"><i class="fa fa-long-arrow-down"></i></a>
	</div>
	<!--End of header area-->



	<!-- benefits
======================================-->
	<div id="section1" class="benefits choose-us">
		<div class="container">
			<div class="row">
				<div class="col-lg-15">
					<div class="choose-wrapper">
						<div class="choose-inner">
							<div class="choose-text">
								<h6>T다이렉트샵</h6>
								<!-- <h1>All your data collected in one place</h1>
								<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut. Labore et </br>
									</br> dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p> -->

								
									<h1>API Information</h1>
									<table id="apiTable">
										<thead>
											<tr>
												<th>ID</th>
												<th>API Name</th>
												<th>API URL</th>
												<th>API Header</th>
												<th>API Body</th>
												<th>API Description</th>
												<th>Request</th>
											</tr>
										</thead>
										<tbody>
											<!-- Data will be populated here -->
										</tbody>
									</table>

									<br> <!-- New line -->
									<!-- <button onclick="redirectToIndexPage()">Go to Index Page</button>
									<button onclick="sendSlackDM()">Slack Push</button> -->

								<a href="#" onclick="index()" class="btn btn-light">Home</a>
								<a href="#" onclick="sendSlackDM()" class="btn btn-light">Slack Push</a>
							</div>
							<!--End of choose text-->
						</div>
						<!--End of choose inner-->
					</div>
					<!--End of choose wrapper-->
				</div>

				<!-- <div class="col-lg-7 text-right">
					<img src="./static/assets/img/features/benefits-bg.png" alt="" class="features-page-img img-fluid">
				</div> -->
			</div>
			<!--End of row-->
		</div>
		<!--End of container-->
		<!-- <a href="#section2" class="scrl-down scroll-down featurepage-scroll-down"><i class="fa fa-long-arrow-down"></i></a> -->
	</div>
	<!--End of benefits-->




	<!-- Footer Area
======================================-->
	<div class="footer-menu">
		
		<div class="container-fluid">
			<div class="row">
				<div class="col-lg-8 text-left">
					<div class="copyright">
						<p>© 2023 SK주식회사 Digital채널사업팀 COPYRIGHT (C) BY SK INC. ALL RIGHT RESERVED. </p>
					</div>
				</div>
				<div class="col-lg-4 text-right">
					<div class="social-icon">
						<a href="#"><i class="fa fa-facebook"></i></a>
						<a href="#"><i class="fa fa-twitter"></i></a>
						<a href="#"><i class="fa fa-google-plus"></i></a>
						<a href="#"><i class="fa fa-instagram"></i></a>
					</div>
				</div>
			</div>
			<!--End of row-->
		</div>
		<!--End of container fluid-->
		<a href="#" class="back-to-top"><i class="fa fa-long-arrow-up"></i></a>
	</div>
	<!--End of Footer Menu-->


	<script src="./static/assets/js/popper.min.js"></script>
	<script src="./static/assets/js/bootstrap.min.js"></script>
	<script src="./static/assets/js/owl.carousel.min.js"></script>
	<script src="./static/assets/js/modal-video.js"></script>
	<script src="./static/assets/js/main.js"></script>

    <script>
        function index() {
            window.location.href = '/'; // Redirect to the insert_api_info.html page
        }
        function redirectToRequestPage() {
            window.location.href = '/request'; // Redirect to the request.html page
        }
		function insert_api_info() {
            window.location.href = '/insert_api_info'; // Redirect to the request.html page
        }


		// function redirectToIndexPage() {
        //     window.location.href = '/'; // Redirect to the index.html page
        // }

        // Function to create a button for each row
        function createRequestButton(apiUrl, apiHeader, apiBody) {
            const button = document.createElement('button');
            button.innerText = 'Request';
            button.onclick = function() {
                const requestOptions = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiUrl, apiHeader, apiBody })
                };

                // Send the API data to the server endpoint
                fetch('/request/make_api_request', requestOptions)
                    .then(response => {
                        if (response.ok) {

                        sendSlackDM(apiUrl, 'ok');
                        } else {
                        sendSlackDM(apiUrl, 'error');
                        return response.json();
                        }
                        if (!response.ok) {
                            throw new Error(`API request failed with status code: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => alert('API Response: ' + JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            };
            return button;
        }


        function sendSlackDM(apiUrl ,message_type) {
            // const message = "Hello, this is a test Slack DM!";
            
            let message;
            if (message_type == 'ok') {
                message = "The API request for " +apiUrl+ " was successful.";
            } else {
                message = "The API request for " +apiUrl+" failed.";
            }

           
            const requestOptions = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message , apiUrl: apiUrl})
            };

            fetch('/send_slack_dm', requestOptions)
                .then(response => response.json())
                .then(data => alert(data.message))
                .catch(error => console.error('Error:', error));
        }




        // Function to send the API request
        function sendAPIRequest(apiUrl, apiHeader, apiBody) {
        // Parse the JSON strings for apiHeader and apiBody
        // console.log(apiUrl, apiHeader, apiBody);
        let headers;
        
        try {
            headers = JSON.parse(apiHeader);
        } catch (error) {
            console.error('Error parsing API Header:', error);
            alert('Error parsing API Header. Please check the input.');
            return;
        }

        let body;
        try {
            body = JSON.parse(apiBody);
        } catch (error) {
            console.error('Error parsing API Body:', error);
            alert('Error parsing API Body. Please check the input.');
            return;
        }

        // Prepare the request options
        const requestOptions = {
            method: 'POST', // Or 'GET', 'PUT', 'DELETE' based on your API
            headers: headers,
            body: JSON.stringify(body)
        };

        // Send the API request
        fetch(apiUrl, requestOptions)
            .then(response => response.json())
            .then(data => alert('API Response: ' + JSON.stringify(data)))
            .catch(error => console.error('Error:', error));
    }

        // Function to fetch API information and populate the table
        function fetchAPIInfo() {
            fetch('/get_all_api_info')
            .then(response => response.json())
            .then(apiInfoList => {
                const tableBody = document.getElementById('apiTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ''; // Clear existing rows
                apiInfoList.forEach(apiInfo => {
                    const newRow = tableBody.insertRow();
                    newRow.insertCell().innerText = apiInfo.ID;
                    newRow.insertCell().innerText = apiInfo.API_NM;
                    newRow.insertCell().innerText = apiInfo.API_URL;
                    newRow.insertCell().innerText = apiInfo.API_HEADER;
                    newRow.insertCell().innerText = apiInfo.API_BODY;
                    newRow.insertCell().innerText = apiInfo.API_DESC;
                    const requestButtonCell = newRow.insertCell();
                    requestButtonCell.appendChild(createRequestButton(apiInfo.API_URL, apiInfo.API_HEADER, apiInfo.API_BODY));
                });
            })
            .catch(error => console.error('Error:', error));
        }

        // function sendTestRequest() {
        //     fetch('/make_test_api_request', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
                   
        //         })
        //     })
        //     .then(response => {
        //         if (response.ok) {

        //             sendSlackDM();
        //         } else {

        //             return response.json();
        //         }
        //     })
        //     .then(data => alert('API Response: ' + JSON.stringify(data)))
        //     .catch(error => console.error('Error:', error));
        // } 

        // Fetch API information on page load
        fetchAPIInfo();


    </script>
</body>

</html>
